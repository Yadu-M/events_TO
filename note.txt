r = redis.Redis(
  host='redis-17286.c89.us-east-1-3.ec2.redns.redis-cloud.com',
  port=17286,
  password='JTdXgbzTiGex3cVMl7QXPsOitm8dRLZO')




import requests
import json

# Toronto Open Data is stored in a CKAN instance. It's APIs are documented here:
# https://docs.ckan.org/en/latest/api/

# To hit our API, you'll be making requests to:
base_url = "https://ckan0.cf.opendata.inter.prod-toronto.ca"
secure_base = "https://secure.toronto.ca"

# Datasets are called "packages". Each package can contain many "resources"
# To retrieve the metadata for this package and its resources, use the package name in this page's URL:
url = base_url + "/api/3/action/package_show"
params = { "id": "festivals-events"}
package_str = requests.get(url, params = params).json()


for idx, meta_data in enumerate(package_str["result"]["resources"]):
  
  if meta_data["format"] == "JSON":
    f_data = open('data.json', 'w')
    f_meta_data = open('metadata.json', 'w')
    
    data = requests.get(meta_data["url"]).text
    
    f_data.write(data)
    f_meta_data.write(json.dumps(meta_data))
    
    f_meta_data.close()
    f_data.close()


